{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Leads",
  "description": "Extended lead data model for Forma ingestion",
  "type": "object",
  "required": [
    "id",
    "tenantId",
    "ownerUserId",
    "pipeline",
    "stage",
    "status",
    "contact",
    "createdAt",
    "updatedAt"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Lead identifier",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "format": "uuid",
      "x-unique-property": true
    },
    "tenantId": {
      "type": "string",
      "description": "Tenant/agency identifier"
    },
    "ownerUserId": {
      "type": "string",
      "description": "Lead owner user ID"
    },
    "pipeline": {
      "type": "string",
      "enum": [
        "buy",
        "rent",
        "sell",
        "landlord"
      ],
      "description": "Pipeline category"
    },
    "stage": {
      "type": "string",
      "enum": [
        "new",
        "contacted",
        "need_defined",
        "viewing",
        "offer",
        "contract",
        "closed"
      ],
      "description": "Pipeline stage"
    },
    "status": {
      "type": "string",
      "enum": [
        "open",
        "won",
        "lost",
        "junk"
      ],
      "description": "Lead status"
    },
    "reason": {
      "type": "string",
      "description": "Reason for closing or disqualifying the lead"
    },
    "temperature": {
      "type": "string",
      "enum": [
        "Hot",
        "Warm",
        "New",
        "Qualified"
      ],
      "description": "Lead temperature tag"
    },
    "rating": {
      "type": "string",
      "description": "Internal rating label (e.g., A/B/C)",
      "pattern": "^[A-Z]$"
    },
    "score": {
      "type": "integer",
      "minimum": 0,
      "description": "Numeric score for sorting and prioritization"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Labels for segmentation and filtering"
    },
    "source": {
      "type": "object",
      "description": "Lead acquisition source",
      "required": [
        "channel"
      ],
      "properties": {
        "channel": {
          "type": "string",
          "enum": [
            "portal",
            "walk_in",
            "referral",
            "phone",
            "web_form",
            "event",
            "other"
          ]
        },
        "name": {
          "type": "string",
          "description": "Source name or platform (e.g., Suumo)"
        },
        "campaign": {
          "type": "string",
          "description": "Campaign identifier"
        },
        "originalLeadId": {
          "type": "string",
          "description": "Upstream platform lead ID"
        }
      }
    },
    "contact": {
      "type": "object",
      "description": "Contact information for the lead",
      "required": [
        "name"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Primary name (Latin alphabet)"
        },
        "nameNative": {
          "type": "string",
          "description": "Native language name"
        },
        "nameKana": {
          "type": "string",
          "description": "Kana representation"
        },
        "birthday": {
          "type": "string",
          "format": "date",
          "description": "Birth date (YYYY-MM-DD)"
        },
        "maritalStatus": {
          "type": "string",
          "enum": [
            "single",
            "married",
            "divorced",
            "widowed",
            "other"
          ],
          "description": "Marital status"
        },
        "currentResidence": {
          "type": "string",
          "description": "Current residential address or area"
        },
        "phones": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[0-9-+() ]+$"
          },
          "description": "Phone numbers"
        },
        "primaryPhone": {
          "type": "string",
          "pattern": "^[0-9-+() ]+$",
          "description": "Preferred phone number"
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email address"
        },
        "lineId": {
          "type": "string",
          "description": "LINE identifier"
        },
        "wechatId": {
          "type": "string",
          "description": "WeChat identifier"
        },
        "company": {
          "type": "string",
          "description": "Employer or company name"
        },
        "occupation": {
          "type": "string",
          "description": "Occupation or title"
        },
        "annualIncome": {
          "type": "number",
          "minimum": 0,
          "description": "Annual income amount"
        },
        "annualIncomeCurrency": {
          "type": "string",
          "enum": [
            "JPY",
            "USD",
            "EUR",
            "CNY",
            "HKD",
            "KRW",
            "SGD"
          ],
          "default": "JPY",
          "description": "Income currency"
        },
        "employmentYear": {
          "type": "integer",
          "minimum": 1900,
          "maximum": 2100,
          "description": "Most recent employment start year"
        },
        "familySize": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of family members excluding the lead"
        },
        "preferredLanguage": {
          "type": "string",
          "enum": [
            "ja",
            "en",
            "zh",
            "ko",
            "other"
          ],
          "description": "Preferred communication language"
        },
        "preferredChannel": {
          "type": "string",
          "enum": [
            "phone",
            "line",
            "email",
            "sms",
            "wechat",
            "other"
          ],
          "description": "Preferred communication channel"
        },
        "isBlacklisted": {
          "type": "boolean",
          "description": "Whether the lead is blacklisted"
        },
        "memo": {
          "type": "string",
          "description": "Free-text notes about the contact"
        }
      }
    },
    "requirement": {
      "type": "object",
      "description": "Property purchase or rental requirements",
      "properties": {
        "intentType": {
          "type": "string",
          "enum": [
            "buy",
            "rent"
          ],
          "description": "Whether the lead intends to buy or rent"
        },
        "purpose": {
          "type": "string",
          "enum": [
            "primary_residence",
            "residence",
            "investment",
            "secondary_residence",
            "other"
          ],
          "description": "Purpose of the property"
        },
        "propertyType": {
          "type": "string",
          "description": "Property type or layout code (e.g., 2LDK)"
        },
        "propertyTypeDescription": {
          "type": "string",
          "description": "Human-readable property type description"
        },
        "budget": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0
            },
            "max": {
              "type": "number",
              "minimum": 0
            },
            "currency": {
              "type": "string",
              "enum": [
                "JPY",
                "USD",
                "EUR",
                "CNY",
                "HKD",
                "KRW",
                "SGD"
              ],
              "default": "JPY"
            },
            "display": {
              "type": "string",
              "description": "Display string for budget range"
            }
          },
          "required": [
            "currency"
          ]
        },
        "size": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0
            },
            "max": {
              "type": "number",
              "minimum": 0
            },
            "unit": {
              "type": "string",
              "enum": [
                "sqm",
                "tsubo",
                "ping"
              ],
              "default": "sqm"
            }
          }
        },
        "targetMoveIn": {
          "type": "string",
          "format": "date",
          "description": "Target move-in date (YYYY-MM-DD)"
        },
        "areas": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "prefecture": {
                "type": "string"
              },
              "city": {
                "type": "string"
              },
              "ward": {
                "type": "string"
              },
              "note": {
                "type": "string"
              }
            }
          },
          "description": "Preferred areas"
        },
        "stationWalkTimeMinutes": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum walking time to station in minutes"
        },
        "unwantedConditions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Conditions to avoid"
        },
        "mustHave": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Non-negotiable requirements"
        },
        "niceToHave": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Desired but optional features"
        },
        "freeText": {
          "type": "string",
          "description": "Free-text requirement notes"
        }
      }
    },
    "propertyInterests": {
      "type": "array",
      "description": "Interest records tied to properties",
      "items": {
        "type": "object",
        "required": [
          "propertyId",
          "status"
        ],
        "properties": {
          "propertyId": {
            "type": "string"
          },
          "snapshot": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "address": {
                "type": "string"
              },
              "price": {
                "type": "number",
                "minimum": 0
              },
              "rent": {
                "type": "number",
                "minimum": 0
              }
            }
          },
          "status": {
            "type": "string",
            "enum": [
              "viewed",
              "favorited",
              "scheduled_viewing",
              "viewed_on_site",
              "offered",
              "rejected",
              "closed"
            ]
          },
          "isPrimary": {
            "type": "boolean"
          },
          "firstSeenAt": {
            "type": "string",
            "format": "date-time"
          },
          "lastActivityAt": {
            "type": "string",
            "format": "date-time"
          },
          "notes": {
            "type": "string"
          }
        }
      }
    },
    "communications": {
      "type": "array",
      "description": "Communication timeline entry IDs (calls, emails, etc.)",
      "items": {
        "type": "string",
        "description": "Communication ID"
      }
    },
    "visits": {
      "type": "array",
      "description": "Property visit IDs tied to this lead",
      "items": {
        "type": "string",
        "description": "Visit ID"
      }
    },
    "firstTouchAt": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp of first touch with the lead"
    },
    "lastContactedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp of the last contact"
    },
    "nextFollowUpAt": {
      "type": "string",
      "format": "date-time",
      "description": "Scheduled next follow-up time"
    },
    "closedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when the lead was closed"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "Record creation timestamp"
    },
    "updatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    }
  }
}